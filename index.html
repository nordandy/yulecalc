<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Julrimskalkylatorn</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@600&display=swap');

        * { box-sizing: border-box; }

        body {
            margin: 0;
            height: 100dvh; 
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            user-select: none;
            -webkit-user-select: none;
            background-color: #e6e6e6; 
        }

        .container {
            aspect-ratio: 235.3 / 396.6;
            width: min(100%, 450px, 95vh * (235.3 / 396.6));
            position: relative;
            container-type: size; 
            box-shadow: 0 0 60px rgba(0,0,0,0.25);
            border-radius: 30px; 
        }

        .bg-desktop { display: block; }
        .bg-mobile { display: none; }

        @media (max-width: 600px) {
            body { background-color: #e0e2e4; }
            .container { box-shadow: none; width: min(100%, 100dvh * (235.3 / 396.6)); }
            .bg-desktop { display: none; }
            .bg-mobile { display: block; }
        }

        svg { width: 100%; height: 100%; display: block; }
        image { pointer-events: none; }

        .display-overlay {
            position: absolute;
            font-family: 'VT323', monospace;
            z-index: 20; 
            color: #ECB328; 
            pointer-events: none; 
        }

        #top-display-container {
            left: 4.1%; top: 1.7%; width: 53.6%; height: 9.3%;
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            /* Fix 2: Remove padding to allow true flex centering */
            padding-top: 0; 
            background-color: transparent; 
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }

        .marquee-wrapper {
            display: flex; align-items: center; white-space: nowrap; will-change: transform;
            position: absolute; left: 0; height: 100%; width: max-content;
            flex-wrap: nowrap; opacity: 0; transition: opacity 0.5s ease-in;
        }

        .marquee-moving { transition-timing-function: linear; transition-property: transform; }

        .yulecalc-logo {
            font-family: 'VT323', monospace;
            font-size: 10cqw; /* Correct requested size */
            color: #ECB328; /* Fix 1: Same color as other text */
            /* Fix 3: Sharp shadow, no blur */
            text-shadow: 1px 1px 0px rgba(0,0,0,0.2); 
            margin: 0 4cqw;
            line-height: 1; /* Fix 4: Tight line-height */
            font-weight: normal;
            flex-shrink: 0;
            padding-top: 0.1em; /* Micro-adjustment for baseline */
        }
        
        .marquee-text {
            font-size: 5.5cqw; color: #8E6710; line-height: 1.2;
            display: flex; align-items: center; flex-shrink: 0; margin: 0 5cqw;
            padding-top: 0.1em; /* Align baseline with logo */
        }

        #main-display-container {
            left: 4.1%; top: 24.3%; width: 91.8%; height: 27.4%;
            padding: 1.5% 0 3% 0; display: flex; flex-direction: column;
            background-color: transparent; 
        }

        #history-line {
            font-size: 4cqw; color: #8E6710; width: 100%; text-align: right;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            line-height: 1.2; flex-shrink: 0; border-bottom: 1px solid rgba(142, 103, 16, 0.4);
            padding-right: 5%; padding-bottom: 1.5%; margin-bottom: 2%;
            min-height: 1.4em; opacity: 0; transition: opacity 0.2s;
        }
        
        #history-line.visible { opacity: 1; }
        #history-line.hidden-border { border-bottom: none !important; }

        #result-area {
            flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column;
            pointer-events: auto; z-index: 50; padding: 0 5% 0 4%;
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 3%, black 97%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 3%, black 97%, transparent 100%);
        }

        #result-content {
            font-size: 5.0cqw; color: #ECB328; line-height: 1.2; text-align: right;
            white-space: pre-wrap; padding-right: 5px; margin-top: auto; margin-bottom: 0;
            text-shadow: 0 0 2px rgba(236, 179, 40, 0.3);
        }
        
        .easter-egg {
            font-size: 8cqw !important; text-align: center !important; color: #ECB328; 
            text-shadow: 0 0 8px rgba(236, 179, 40, 0.6);
            margin-top: auto; margin-bottom: auto !important; 
        }

        #result-area::-webkit-scrollbar { width: 6px; }
        #result-area::-webkit-scrollbar-track { background: rgba(142, 103, 16, 0.1); margin: 5px 0; }
        #result-area::-webkit-scrollbar-thumb { background: #8E6710; border-radius: 4px; }

        .screen-bg { fill: #160802; transition: fill 0.6s ease-in-out; }
        .container.off .screen-bg { fill: #000000; }

        .snow-cross { stroke: #ECB328; stroke-width: 1.5; stroke-linecap: round; pointer-events: none; }
        .snow-pixel { fill: #ECB328; shape-rendering: crispEdges; pointer-events: none; }
        
        .banner-char { font-family: 'VT323', monospace; font-size: 14px; fill: #ECB328; text-anchor: middle; }
        
        #santa-sprite {
            display: none; pointer-events: none;
            image-rendering: pixelated; 
        }

        .hitbox { fill: rgba(255,255,255,0); stroke: none; cursor: pointer; pointer-events: all; }
        .hitbox-shadow:active { fill: rgba(0, 0, 0, 0.4); }
        .off .hitbox { cursor: default; pointer-events: none; }
        .off #btn-side-power { pointer-events: all; cursor: pointer; }

        #lever-knob { fill: #222; transition: cx 0.2s cubic-bezier(0.2, 1.2, 0.2, 1); pointer-events: none; }
        
        #mute-light { fill: transparent; stroke: none; transition: fill 0.1s; }
        #mute-light.lit { fill: #ffffff; filter: drop-shadow(0 0 2px #ffffff); }

    </style>
</head>
<body>

<div class="container" id="calculator">
    
    <div id="top-display-container" class="display-overlay">
        <div class="marquee-wrapper" id="marquee">
            <span class="yulecalc-logo">YULECALC</span>
            <span class="marquee-text">JULRIMSKALKYLATORN 1.0 — EN HANDYMAN PRODUKTION — DRIVS AV GLÖGG OCH JULMAGI</span>
            <span class="yulecalc-logo">YULECALC</span>
        </div>
    </div>

    <div id="main-display-container" class="display-overlay">
        <div id="history-line"></div> 
        <div id="result-area">
            <div id="result-content">VÄLJ GÅVA...</div> 
        </div>
    </div>

    <svg version="1.1" viewBox="0 0 235.3 396.6" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <clipPath id="screen-mask">
                <path d="M9.6,96.4c-.4,0-.9.1-1.3.3-.9.5-1.5,1.5-1.5,2.5v108.6c0,1.6,1.3,2.8,2.8,2.8h216c1.6,0,2.8-1.3,2.8-2.8h0v-108.6c0-.4-.1-.9-.3-1.3-.5-.9-1.5-1.5-2.5-1.5H9.6Z" />
            </clipPath>
        </defs>

        <image class="bg-desktop" href="assets/christmas_calculator.png" x="0" y="0" width="235.3" height="396.6" />
        <image class="bg-mobile" href="assets/christmas_calculator_mobile.png" x="0" y="0" width="235.3" height="396.6" />
        
        <path class="screen-bg" d="M9.6,6.8h126.3c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8H9.6c-1.6,0-2.8-1.3-2.8-2.8h0V9.6c0-1.6,1.3-2.8,2.8-2.8h0" />
        <path class="screen-bg" d="M9.6,96.4c-.4,0-.9.1-1.3.3-.9.5-1.5,1.5-1.5,2.5v108.6c0,1.6,1.3,2.8,2.8,2.8h216c1.6,0,2.8-1.3,2.8-2.8h0v-108.6c0-.4-.1-.9-.3-1.3-.5-.9-1.5-1.5-2.5-1.5H9.6Z" />

        <circle id="mute-light" cx="28" cy="89.6" r="1.9"/>

        <g id="Interactive_Buttons">
            <circle class="hitbox hitbox-shadow" cx="28" cy="72.8" r="12.5" onclick="toggleSound()" />
            <circle class="hitbox hitbox-shadow" cx="72.8" cy="72.8" r="12.5" onclick="connectNorthPole()" />
            <circle class="hitbox hitbox-shadow" cx="117.6" cy="72.8" r="12.5" onclick="showHelp()" />

            <path class="hitbox hitbox-shadow" onclick="input(7)" d="M9.6,212.9h36.9c1.6,0,2.8,1.3,2.8,2.8h0v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8"/>
            <path class="hitbox hitbox-shadow" onclick="input(8)" d="M54.4,212.9h36.9c1.6,0,2.8,1.3,2.8,2.8h0v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8"/>
            <path class="hitbox hitbox-shadow" onclick="input(9)" d="M99.2,212.9h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            
            <path class="hitbox hitbox-shadow" onclick="input(4)" d="M9.6,257.7h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8H9.6c-1.6,0-2.8-1.3-2.8-2.8h0v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            <path class="hitbox hitbox-shadow" onclick="input(5)" d="M54.4,257.7h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            <path class="hitbox hitbox-shadow" onclick="input(6)" d="M99.2,257.7h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            
            <path class="hitbox hitbox-shadow" onclick="input(1)" d="M9.6,302.5h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8H9.6c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            <path class="hitbox hitbox-shadow" onclick="input(2)" d="M54.4,302.5h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            <path class="hitbox hitbox-shadow" onclick="input(3)" d="M99.2,302.5h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>
            
            <path class="hitbox hitbox-shadow" onclick="input(0)" d="M99.2,347.3h36.9c1.6,0,2.8,1.3,2.8,2.8v36.9c0,1.6-1.3,2.8-2.8,2.8h-36.9c-1.6,0-2.8-1.3-2.8-2.8v-36.9c0-1.6,1.3-2.8,2.8-2.8h0"/>

            <circle class="hitbox hitbox-shadow" onclick="action('CLEAR')" cx="162.5" cy="234.2" r="12.5" />
            <circle class="hitbox hitbox-shadow" onclick="togglePower()" id="btn-side-power" cx="207.3" cy="234.2" r="12.5" />
            <circle class="hitbox hitbox-shadow" onclick="action('BACK')" cx="162.5" cy="278.9" r="12.5" />
            <circle class="hitbox hitbox-shadow" onclick="action('RANDOM')" cx="207.3" cy="278.9" r="12.5" />

            <path class="hitbox hitbox-shadow" onclick="action('ADD')" ontouchstart="event.preventDefault(); action('ADD')" d="M207.2,311.3c6.9,0,12.5,5.6,12.5,12.5s-5.6,12.5-12.5,12.5h-44.8c-6.9,0-12.5-5.6-12.5-12.5s5.6-12.5,12.5-12.5h44.8Z" />
            
            <path class="hitbox hitbox-shadow" onclick="generateRhyme()" d="M207.2,356.1c6.9,0,12.5,5.6,12.5,12.5s-5.6,12.5-12.5,12.5h-44.8c-6.9,0-12.5-5.6-12.4-12.5,0-6.9,5.6-12.4,12.4-12.4h44.8Z" />
        </g>

        <g clip-path="url(#screen-mask)">
            <g id="flappy-background">
                <image id="bg-1" href="assets/flappy_bg.png" x="0" y="96" width="236" height="109" preserveAspectRatio="none" style="display:none;" />
                <image id="bg-2" href="assets/flappy_bg.png" x="235.3" y="96" width="236" height="109" preserveAspectRatio="none" style="display:none;" />
            </g>
            <g id="pipe-layer"></g> 
            <g id="snow-layer"></g>
            
            <g id="santa-group" style="display:none; pointer-events:none;">
                <g id="santa-banner-group"></g>
                <image id="santa-sprite" href="assets/santa_frame_1.png" width="80" height="40" />
            </g>
            
            <g id="game-overlay" style="display:none; pointer-events:none;">
                <rect x="-5" y="0" width="245" height="400" fill="rgba(0,0,0,0.8)" />
                <g id="game-overlay-content"></g>
            </g>
        </g>

        <circle id="lever-knob" cx="18.5" cy="368.5" r="4.5" style="fill:#333; stroke:none;" />
        <rect x="10" y="355" width="80" height="30" class="hitbox" onclick="adjustKnob()" />

    </svg>
</div>

<script src="script.js"></script>
</body>
</html>